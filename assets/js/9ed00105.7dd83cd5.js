"use strict";(self.webpackChunkwebsite=self.webpackChunkwebsite||[]).push([[4],{4852:(e,t,n)=>{n.d(t,{Zo:()=>u,kt:()=>f});var i=n(9231);function a(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function o(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,i)}return n}function r(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?o(Object(n),!0).forEach((function(t){a(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):o(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function l(e,t){if(null==e)return{};var n,i,a=function(e,t){if(null==e)return{};var n,i,a={},o=Object.keys(e);for(i=0;i<o.length;i++)n=o[i],t.indexOf(n)>=0||(a[n]=e[n]);return a}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(i=0;i<o.length;i++)n=o[i],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(a[n]=e[n])}return a}var c=i.createContext({}),s=function(e){var t=i.useContext(c),n=t;return e&&(n="function"==typeof e?e(t):r(r({},t),e)),n},u=function(e){var t=s(e.components);return i.createElement(c.Provider,{value:t},e.children)},p={inlineCode:"code",wrapper:function(e){var t=e.children;return i.createElement(i.Fragment,{},t)}},m=i.forwardRef((function(e,t){var n=e.components,a=e.mdxType,o=e.originalType,c=e.parentName,u=l(e,["components","mdxType","originalType","parentName"]),m=s(n),f=a,d=m["".concat(c,".").concat(f)]||m[f]||p[f]||o;return n?i.createElement(d,r(r({ref:t},u),{},{components:n})):i.createElement(d,r({ref:t},u))}));function f(e,t){var n=arguments,a=t&&t.mdxType;if("string"==typeof e||a){var o=n.length,r=new Array(o);r[0]=m;var l={};for(var c in t)hasOwnProperty.call(t,c)&&(l[c]=t[c]);l.originalType=e,l.mdxType="string"==typeof e?e:a,r[1]=l;for(var s=2;s<o;s++)r[s]=n[s];return i.createElement.apply(null,r)}return i.createElement.apply(null,n)}m.displayName="MDXCreateElement"},8304:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>c,contentTitle:()=>r,default:()=>p,frontMatter:()=>o,metadata:()=>l,toc:()=>s});var i=n(8041),a=(n(9231),n(4852));const o={hide_title:!0},r=void 0,l={unversionedId:"configuration",id:"configuration",title:"configuration",description:"Configuration",source:"@site/docs/configuration.md",sourceDirName:".",slug:"/configuration",permalink:"/website/configuration",draft:!1,editUrl:"https://github.com/mocktomata/website/blob/main/docs/configuration.md",tags:[],version:"current",frontMatter:{hide_title:!0},sidebar:"mocktomata",previous:{title:"Spec",permalink:"/website/spec"},next:{title:"plugin",permalink:"/website/plugin"}},c={},s=[{value:"Configuration",id:"configuration",level:2},{value:"Configuration File",id:"configuration-file",level:2},{value:"Environment Variables",id:"environment-variables",level:2},{value:"Using <code>config()</code>",id:"using-config",level:2},{value:"Tips and Tricks",id:"tips-and-tricks",level:2},{value:"Define plugins in configuration file",id:"define-plugins-in-configuration-file",level:3},{value:"Change mode using <code>config()</code> function",id:"change-mode-using-config-function",level:3},{value:"Use Environment Variables in CI",id:"use-environment-variables-in-ci",level:3},{value:"Acceptance Tests",id:"acceptance-tests",level:3},{value:"Refresh Records",id:"refresh-records",level:3}],u={toc:s};function p(e){let{components:t,...n}=e;return(0,a.kt)("wrapper",(0,i.Z)({},u,n,{components:t,mdxType:"MDXLayout"}),(0,a.kt)("h2",{id:"configuration"},"Configuration"),(0,a.kt)("p",null,"Hi, it's ",(0,a.kt)("a",{parentName:"p",href:"/website/mockto"},(0,a.kt)("inlineCode",{parentName:"a"},"mockto"))," here again."),(0,a.kt)("p",null,"Remember that in ",(0,a.kt)("a",{parentName:"p",href:"/website/"},"introduction"),", I mentioned that:"),(0,a.kt)("blockquote",null,(0,a.kt)("p",{parentName:"blockquote"},"We can isolate your code from the changes and uncertainty of the outside world.\nAnd we can connect your code back by a flip of a switch.")),(0,a.kt)("p",null,'The "flip of a switch" part is where configuration comes in.'),(0,a.kt)("p",null,"Also, you might know from ",(0,a.kt)("a",{parentName:"p",href:"/website/incubator"},(0,a.kt)("inlineCode",{parentName:"a"},"incubator"))," that ",(0,a.kt)("a",{parentName:"p",href:"https://github.com/mocktomata/mocktomata/blob/master/packages/mocktomata"},"mocktomata")," supports ",(0,a.kt)("a",{parentName:"p",href:"/website/plugin"},"plugins"),".\nYou can add ",(0,a.kt)("a",{parentName:"p",href:"/website/plugin"},"plugins")," to help ",(0,a.kt)("a",{parentName:"p",href:"https://github.com/mocktomata/mocktomata/blob/master/packages/mocktomata"},"mocktomata")," to handle some specific use cases."),(0,a.kt)("p",null,"That is also configured in the configuration."),(0,a.kt)("p",null,"There are 3 ways to configure ",(0,a.kt)("a",{parentName:"p",href:"https://github.com/mocktomata/mocktomata/blob/master/packages/mocktomata"},"mocktomata"),":"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("a",{parentName:"li",href:"#configuration-file"},"Config file")),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("a",{parentName:"li",href:"#environment-variables"},"Environment variables")),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("a",{parentName:"li",href:"#using-config"},"Runtime ",(0,a.kt)("inlineCode",{parentName:"a"},"config()")," call"))),(0,a.kt)("p",null,"Each of them can configure different settings.\nAnd when there are conflicts,"),(0,a.kt)("blockquote",null,(0,a.kt)("p",{parentName:"blockquote"},(0,a.kt)("inlineCode",{parentName:"p"},"config()")," > Environment variables > Config file")),(0,a.kt)("h2",{id:"configuration-file"},"Configuration File"),(0,a.kt)("p",null,(0,a.kt)("a",{parentName:"p",href:"https://github.com/mocktomata/mocktomata/blob/master/packages/mocktomata"},"mocktomata")," will look for configuration in the file ",(0,a.kt)("inlineCode",{parentName:"p"},"mocktomata.json")," at the root of the project,\nor a ",(0,a.kt)("inlineCode",{parentName:"p"},"mocktomata")," section inside your ",(0,a.kt)("inlineCode",{parentName:"p"},"package.json"),"."),(0,a.kt)("p",null,"Only one of them can be used at a time.\nIf more than one configuration are found,\nwe will throw a ",(0,a.kt)("inlineCode",{parentName:"p"},"AmbiguousConfig")," error."),(0,a.kt)("p",null,"Using ",(0,a.kt)("inlineCode",{parentName:"p"},"mocktomata.json")," as an example,\nhere is what can be configured and their default values:"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-js"},'{\n  // Default: `es2015`\n  "ecmaVersion": "<es2015 | es2020>",\n  // Overrides the calls with `auto` mode to a specific mode.\n  "overrideMode": "<live | save | simulate>",\n  // Filter the calls to override using file path.\n  "filePathFilter": "<regex>",\n  // Filter the calls to override using spec name.\n  "specNameFilter": "<regex>",\n  // A list of plugins to use.\n  "plugins": ["plugin-a"],\n  // log level inside `mocktomata`. Default: "info"\n  "logLevel": "error" | "warn" | "info" | "debug" | "trace" | "all",\n  // should the log emit to console. Default: false\n  "emitLog": boolean\n}\n')),(0,a.kt)("h2",{id:"environment-variables"},"Environment Variables"),(0,a.kt)("p",null,"Specific configuration can be overridden using environment variables.\nThis allows different CI jobs to run ",(0,a.kt)("a",{parentName:"p",href:"https://github.com/mocktomata/mocktomata/blob/master/packages/mocktomata"},"mocktomata")," with different configuration."),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"MOCKTOMATA_MODE"),": ",(0,a.kt)("inlineCode",{parentName:"li"},"overrideMode")),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"MOCKTOMATA_FILE_PATH_FILTER"),": ",(0,a.kt)("inlineCode",{parentName:"li"},"filePathFilter")),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"MOCKTOMATA_SPEC_NAME_FILTER"),": ",(0,a.kt)("inlineCode",{parentName:"li"},"specNameFilter")),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"MOCKTOMATA_LOG_LEVEL"),": ",(0,a.kt)("inlineCode",{parentName:"li"},"logLevel"))),(0,a.kt)("h2",{id:"using-config"},"Using ",(0,a.kt)("inlineCode",{parentName:"h2"},"config()")),(0,a.kt)("p",null,"Configuration can also be overridden in the runtime using the ",(0,a.kt)("a",{parentName:"p",href:"#using-config"},(0,a.kt)("inlineCode",{parentName:"a"},"config()"))," function."),(0,a.kt)("p",null,"This is useful when the configuration is stored in different means (e.g. database or remote service),\nor used during test startup or test runner plugins (e.g. jest watch plugins) so that the test process do not need to be restarted and do not need to manually change the configuration files."),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-js"},'import { config } from \'mocktomata\'\n\nconfig({\n  ecmaVersion: "<es2015 | es2020>",\n  overrideMode: "<live | save | simulate>",\n  filePathFilter: "<regex>",\n  specNameFilter: "<regex>",\n  plugins: ["plugin-a"],\n  // currently only debug level is available\n  logLevel: \'debug\',\n  emitLog: true\n})\n')),(0,a.kt)("p",null,"Note the ",(0,a.kt)("a",{parentName:"p",href:"/website/incubator"},(0,a.kt)("inlineCode",{parentName:"a"},"incubator"))," has its own ",(0,a.kt)("a",{parentName:"p",href:"/website/incubator#config"},(0,a.kt)("inlineCode",{parentName:"a"},"incubator.config()"))," to add plugins for testing."),(0,a.kt)("h2",{id:"tips-and-tricks"},"Tips and Tricks"),(0,a.kt)("p",null,"Each configuration mechanism provided is designed for a specific purpose.\nBy using these mechanisms with their intended usage,\nit would be easier for you to configure ",(0,a.kt)("inlineCode",{parentName:"p"},"mocktomata")," to your specific needs."),(0,a.kt)("h3",{id:"define-plugins-in-configuration-file"},"Define plugins in configuration file"),(0,a.kt)("p",null,"This is kind of a no-brainer.\nIf you need a plugin, add it to ",(0,a.kt)("inlineCode",{parentName:"p"},"mocktomata.json"),"."),(0,a.kt)("h3",{id:"change-mode-using-config-function"},"Change mode using ",(0,a.kt)("inlineCode",{parentName:"h3"},"config()")," function"),(0,a.kt)("p",null,"While you can do the same with environment variable,\ncalling ",(0,a.kt)("a",{parentName:"p",href:"#using-config"},(0,a.kt)("inlineCode",{parentName:"a"},"config()"))," in a test setup file is much easier and faster."),(0,a.kt)("p",null,"Especially when you try to flip tests quickly."),(0,a.kt)("h3",{id:"use-environment-variables-in-ci"},"Use Environment Variables in CI"),(0,a.kt)("p",null,"Environment variable based configuration is designed for CI usage."),(0,a.kt)("h3",{id:"acceptance-tests"},"Acceptance Tests"),(0,a.kt)("p",null,"Turn your tests into acceptance tests by running tests with ",(0,a.kt)("inlineCode",{parentName:"p"},"overrideMode = 'live'"),"."),(0,a.kt)("h3",{id:"refresh-records"},"Refresh Records"),(0,a.kt)("p",null,"You can easily refresh all records by running tests with ",(0,a.kt)("inlineCode",{parentName:"p"},"overrideMode = 'save'"),"."))}p.isMDXComponent=!0}}]);